name: Update README

on:
  workflow_call:
    inputs:
      step:
        description: 'Current step number'
        required: true
        type: number

permissions:
  contents: write

jobs:
  update_readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main branch
        uses: actions/checkout@v4
        with:
          ref: main
          fetch-depth: 0

      - name: Update README
        run: |
          STEP=${{ inputs.step }}
          
          # Create the progressive README content
          cat > README.md << 'EOF'
          # üéì GitHub MCP Workflow - Interactive Learning Exercise

          <div align="center">

          ![GitHub MCP](https://img.shields.io/badge/GitHub-MCP-blue?style=for-the-badge&logo=github)
          ![Interactive](https://img.shields.io/badge/Type-Interactive-green?style=for-the-badge)
          ![Skill Level](https://img.shields.io/badge/Level-Beginner-brightgreen?style=for-the-badge)

          **Learn GitHub workflows with AI assistance through hands-on practice!**

          </div>

          ---
          EOF
          
          # Add step progress indicator
          if [ $STEP -eq 0 ]; then
            cat >> README.md << 'EOF'
          ## üìç Current Progress

          **Step 0: Getting Started** ‚¨ÖÔ∏è You are here

          - [ ] **Step 1:** Fix the CSS Bug
          - [ ] **Step 2:** Create a Pull Request  
          - [ ] **Step 3:** Merge and Complete

          ---

          ## üöÄ Get Started

          **Welcome!** Your first issue has been created with detailed instructions.

          üëâ [Go to your issue](../../issues) to begin!

          ### What to do:

          1. Click on the issue titled "üéì GitHub MCP Workflow Exercise"
          2. Read the instructions in the first comment
          3. Follow the Copilot prompts to complete Step 1

          EOF
          elif [ $STEP -eq 1 ]; then
            cat >> README.md << 'EOF'
          ## üìç Current Progress

          - [x] ~~Step 0: Getting Started~~
          - [ ] **Step 1: Fix the CSS Bug** ‚¨ÖÔ∏è You are here
          - [ ] **Step 2:** Create a Pull Request
          - [ ] **Step 3:** Merge and Complete

          ---

          ## üêõ Step 1: Fix the CSS Bug

          **Great start!** Now it's time to investigate and fix the styling issue.

          ### Your Task:

          Use GitHub Copilot to:
          1. Investigate why the styling is broken
          2. Create a hotfix branch
          3. Fix the CSS link typo
          4. Commit and push your changes

          üëâ Check your [issue](../../issues) for detailed prompts to use with Copilot!

          EOF
          elif [ $STEP -eq 2 ]; then
            cat >> README.md << 'EOF'
          ## üìç Current Progress

          - [x] ~~Step 0: Getting Started~~
          - [x] ~~Step 1: Fix the CSS Bug~~ ‚úÖ
          - [ ] **Step 2: Create a Pull Request** ‚¨ÖÔ∏è You are here
          - [ ] **Step 3:** Merge and Complete

          ---

          ## üîÄ Step 2: Create a Pull Request

          **Excellent work fixing the bug!** Now let's create a professional PR.

          ### Your Task:

          Use GitHub Copilot MCP tools to:
          1. Create a Pull Request from your hotfix branch to main
          2. Link it to the exercise issue using "Fixes #X"
          3. Wait for automated validation

          üëâ Check your [issue](../../issues) for the exact prompts!

          EOF
          elif [ $STEP -eq 3 ]; then
            cat >> README.md << 'EOF'
          ## üìç Current Progress

          - [x] ~~Step 0: Getting Started~~
          - [x] ~~Step 1: Fix the CSS Bug~~ ‚úÖ
          - [x] ~~Step 2: Create a Pull Request~~ ‚úÖ
          - [x] **Step 3: Merge and Complete** ‚úÖ

          ---

          ## üéâ Congratulations!

          **You've completed the GitHub MCP Workflow exercise!**

          ### What You Accomplished:

          ‚úÖ Used Copilot to investigate and diagnose a bug  
          ‚úÖ Created a proper hotfix branch  
          ‚úÖ Fixed code with AI assistance  
          ‚úÖ Created a Pull Request using MCP tools  
          ‚úÖ Completed a full DevOps workflow from VS Code  

          ### üåü What's Next?

          Level up your AI development skills:

          - ü§ñ [GitHub Coding Agent Demo](https://github.com/david-pizzi-cg/github-coding-agent-demo) - Learn autonomous AI workflows
          - üõ°Ô∏è [GitHub Copilot Instructions Demo](https://github.com/david-pizzi-cg/github-copilot-instructions-demo) - Add safeguards to AI development

          ---

          **Want to practice again?** Reset your repository and go through the steps with different approaches!

          EOF
          fi
          
          # Add common footer
          cat >> README.md << 'EOF'

          ---

          ## üìñ About This Exercise

          This interactive learning experience teaches you how to use **GitHub MCP (Model Context Protocol)** with **VS Code Copilot** for AI-assisted development workflows.

          ### Key Learning Outcomes:

          - ‚úÖ GitHub MCP Integration in VS Code
          - ‚úÖ AI-Assisted Debugging with Copilot
          - ‚úÖ Professional Git Branching Strategies
          - ‚úÖ Issue Management and PR Workflows
          - ‚úÖ DevOps Best Practices

          ### üîß Technologies Used:

          - **GitHub MCP Server** - Connect Copilot to GitHub
          - **GitHub Actions** - Automated validation
          - **VS Code Copilot** - AI-powered coding assistant
          - **Git** - Version control

          ---

          ## ü§ù Contributing

          Found a bug or have suggestions? Feel free to open an issue or submit a PR!

          ---

          ## üìÑ License

          This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

          ---

          <div align="center">

          Made with ‚ù§Ô∏è for developers learning AI workflows

          </div>
          EOF

      - name: Commit README changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Update README for step ${{ inputs.step }}"
            git push
          fi
