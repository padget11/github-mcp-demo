name: Step 0 - Start Exercise

on:
  push:
    branches:
      - main
    paths:
      - '.github/workflows/0-welcome.yml'
  workflow_dispatch:
  repository_dispatch:
    types: [start-exercise]

permissions:
  contents: write
  actions: write
  issues: write

jobs:
  start_exercise:
    name: Start Exercise
    uses: skills/exercise-toolkit/.github/workflows/start-exercise.yml@v0.7.3
    with:
      exercise-title: "GitHub MCP Workflow Exercise"
      intro-message: |
        This is a **hands-on learning experience** where you'll discover how to **use GitHub Copilot with MCP tools** to streamline your entire development workflow.

        ### ðŸŽ¯ What You'll Learn

        This exercise teaches you how to **prompt Copilot** to:
        - ðŸ” Investigate and diagnose code issues
        - ðŸŒ¿ Create branches using git commands
        - ðŸ› ï¸ Make code fixes and commits
        - ðŸ“ Create GitHub issues via MCP tools
        - ðŸ”€ Create Pull Requests via MCP tools
        - âœ… Complete the full DevOps cycle from VS Code

        ### ðŸ› The Challenge

        This World Clock application has a **critical styling bug** - the CSS isn't loading! You'll use Copilot to investigate, fix, and deploy the solution.

        ðŸ’¡ **Ready to start?** Scroll down for Step 1 instructions! ðŸ‘‡
    permissions:
      contents: write
      issues: write
      actions: write

  post_step_instructions:
    name: Post Step Instructions
    needs: [start_exercise]
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get response templates
        uses: actions/checkout@v4
        with:
          repository: skills/exercise-toolkit
          path: exercise-toolkit
          ref: v0.7.3

      - name: Create comment - add step content
        uses: GrantBirki/comment@v2.1.1
        with:
          issue-number: ${{ needs.start_exercise.outputs.issue-number }}
          file: responses/01-fix-css.md

      - name: Create comment - watching for progress
        uses: GrantBirki/comment@v2.1.1
        with:
          issue-number: ${{ needs.start_exercise.outputs.issue-number }}
          body: "ðŸ‘€ I'm watching for your changes. When you push your CSS fix to a branch, I'll automatically check your work!"

      - name: Enable next step workflow
        run: |
          gh workflow enable 1-fix-css.yml
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Build README from template
        id: build-readme
        uses: skills/action-text-variables@v3
        with:
          template-file: .github/readme-templates/step-1.md

      - name: Update README file
        run: echo "$README_CONTENT" > README.md
        env:
          README_CONTENT: ${{ steps.build-readme.outputs.updated-text }}

      - name: Commit README changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Update README for step 1"
            git push
          fi
